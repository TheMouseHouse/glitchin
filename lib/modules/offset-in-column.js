'use strict';var _=require('lodash'),Utils=require('../modules/utils'),Columns=require('../modules/columns'),debug=require('debug')('modules/offset-in-columns');module.exports=function(a,b,c){function d(h){var i=-e+h;return i>=f&&(i-=f),0>i&&(i+=f),i}_.isUndefined(a)&&debug('Image is not defined in Offset.module.');var e,f=a.bitmap.height;if(_.isNumber(c)?(c=~~Math.round(c),e=c>f||c<-f?c%f:c):_.isUndefined(c)&&(e=_.random(f)),_.isFunction(c)||debug('Offsetting '+b+' in columns by '+e+'pixels...'),_.isUndefined(b))return a;if(_.isString(b))b=[b];else if(!_.isArray(b))return a;var g=[];return _.each(a.glitch.columns,function(h,i){g[i]=[],_.isFunction(c)&&(e=c(a,i)),_.each(h,function(j,l){var m=d(l);g[i][l]=j,_.each(b,function(n){g[i][l][n]=Utils.getChannel(a,n)[i][m]})})}),Columns(a,g)};